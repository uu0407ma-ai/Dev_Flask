[总结清单](https://github.com/uu0407ma-ai/Dev_Flask/blob/master/readme_zh.md)

---

# Flask 项目：问答系统

这是一个基于 Flask 构建的问答系统，包含了用户注册、登录、电子邮件验证、问答功能、答案提交和搜索等功能。项目使用了 Flask-Migrate 进行数据库迁移，使用 Flask-Mail 进行邮件发送，使用 Flask-WTF 进行表单验证，并通过 AJAX 和前后端交互实现了验证码倒计时等功能。

## 安装和配置

### 1. 安装依赖

项目依赖以下库：

```bash
# 安装数据库迁移工具
pip install flask-migrate

# 安装邮件发送功能
pip install flask-mail

# 安装表单验证功能
pip install flask-wtf

# 安装邮箱验证工具
pip install email_validator
```

### 2. 数据库迁移（三部曲）

为了确保数据库结构正确并同步，我们使用 Flask-Migrate 进行数据库迁移：

```bash
# 初始化迁移
flask db init

# 生成迁移脚本
flask db migrate

# 应用迁移到数据库
flask db upgrade
```

### 3. 电子邮件验证

#### 1. 配置 Flask-Mail

* 在应用的配置中配置电子邮件服务信息。
* 在扩展中初始化 Flask-Mail。
* 在 `auth.py` 中创建发送邮件的视图函数，并通过 `/mail/test` 路径测试邮件功能是否正常。

#### 2. 验证码发送和存储

* 创建 `/captcha/email` 视图函数，接收用户请求并生成验证码，发送到用户邮箱。
* 将验证码存储到数据库中（修改模型，生成迁移）。

#### 3. 前端与 AJAX 集成

* 更新 HTML 路径，使用 `url_for` 替代相对路径，确保 CSS 文件能正确加载。
* 实现验证码倒计时功能。

---

## 用户身份验证

### 1. 登录功能

* 修改数据库的登录表单，增加邮箱字段。
* 更新登录后端逻辑，设置会话并生成密钥。
* 配置 `SECRET_KEY`，确保会话的安全性。

### 2. 用户身份验证钩子函数

* 在 `app.py` 中实现了两个钩子函数，分别处理已登录和未登录状态之间的切换。
* 在 `auth.py` 中实现了注销功能，确保用户退出后会清除会话信息。

---

## 问答功能

### 1. 发布问题和答案

* 实现了发布问题和答案的视图函数和对应的 HTML 页面。
* 增加了装饰器，用于验证用户是否已登录。如果未登录，则无法发布问题或答案。

### 2. 渲染问答模板

* 在 `index.html` 中展示问题列表。
* 在 `detail.html` 中展示问题详情，并实现从主页到问题详情页的导航。

### 3. 问答列表页

* 修改了 `detail.html`，确保问题和答案能够正确显示。
* 使用 AJAX 渲染答案列表，实现前后端交互。

---

## 问题解决与优化

### 1. CSS 加载问题

在开发过程中，遇到了 CSS 文件加载问题，经过调试，发现问题出在 `base.html` 使用了相对路径，而非通过 `url_for` 动态加载文件。修改后，问题得以解决。

### 2. 数据库表创建问题

遇到数据库表创建时的错误，特别是 `question` 表已存在问题。解决方案是删除数据库和 `migrations` 文件夹，重新初始化迁移，确保数据库表正确创建。

### 3. 密码字段长度问题

由于哈希加密后的密码长度超过了数据库密码字段的限制，导致服务器错误。通过修改 `UserModel` 中的密码字段长度，将其设为 `VARCHAR(255)`，并执行迁移解决了该问题。

### 4. 提交错误修复

在开发过程中，发现提交问答时没有返回 `return` 语句，导致无法提交问题或答案。修改后问题解决。

---

## 搜索功能

* 在问答模块中实现了搜索功能。
* 后端提供搜索接口，前端更新基础 HTML 以支持搜索框和结果展示。

---

## 完成与总结

### 1. 项目功能

本项目通过实现以下功能，完成了一个基本的问答系统：

* 用户注册、登录、电子邮件验证。
* 发布问题、答案以及管理用户会话。
* 搜索功能和答案提交。
* 基本的前后端交互，包括使用 AJAX 处理验证码和答案提交。

### 2. 提交与文档

在项目完成后，所有功能都经过了充分的测试。提交信息和历史记录已优化，并确保文档清晰易懂。

---

## 相关链接

* **视频教程**: [点击观看](https://www.bilibili.com/video/BV17r4y1y7jJ?p=41&vd_source=1a0df84062fc3afe05ddb5436ffce988)
---

### 其他说明

* 如果你觉得这个项目对你有所帮助，可以给我一个 **Star**！
* 项目中有一些问题和挑战的解决方法，以及在开发过程中不断迭代和优化的思考。如果你在开发过程中遇到类似的问题，欢迎参考本项目的解决方案。
